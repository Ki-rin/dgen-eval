f"Extract a short list of key requirements that the Model Risk Management Validator " 
f"expects in the {section_cell.value} section of the low-risk model documentation, " 
f"focusing on the sub-sub-section written by the developer about {question_cell.value}."
----
prompt: |
  Evaluate the output for hallucination based on the question below, marked between triple exclamation marks (!!!):

  **Output:** {output}  
  **Question:** !!! {question} !!!

  Assume the output was generated using additional context that is NOT provided here. Your task is to detect only clear and extreme hallucinations, where the output strays far from the subject of the question. Specifically, look for:
  - Topics that are entirely unrelated to the question's domain (e.g., the output discusses celebrities or unrelated entertainment topics when the question is about MRM requirements).
  - Information that has no logical connection to the question, even with missing context.
  - Statements or references that introduce content completely irrelevant to the domain of model risk management, systems, or related applications.

  **Evaluation Criteria:**
  - Does the output introduce topics that are clearly and significantly unrelated to the question's domain or subject?
  - Are there references or statements that are far outside the expected scope of the question, such as introducing concepts from unrelated fields like pop culture or sports?
  - Do NOT penalize content that could plausibly relate to the question, such as references to Citi, LLMs, or applications, as long as it aligns broadly with the question's domain.

  **Provide:**
  - **Score:**
    - "0" if the output stays within the broad domain of the question, even if it includes references that depend on missing context.
    - "1" if the output includes extreme hallucinations, such as introducing clearly unrelated or off-topic information.
  - **Comment:** Provide a brief explanation for the score, highlighting any examples of unrelated or far-off-topic content in the output.

  **Important Notes:**
  - Only flag hallucinations if the output clearly and significantly deviates from the question's domain or subject.
  - Do NOT flag related references, even if tangential, as long as they align with the broader scope of the question.
  - Focus on detecting extreme topic shifts or irrelevant content that has no logical connection to the question.

---

evaluation_prompts:
  - section: "1. Coherence/Clarity"
    description: "Evaluate if the output is clear, easy to understand, and maintains a logical flow."
    prompt: |
      Evaluate the following output for coherence and clarity:
      Output: {output}
      Criteria:
        - Does the output maintain a clear logical flow?
        - Is it easy to understand?
      Provide:
        - **Score**:
          - "1" if the output is clear and logically structured.
          - "0.5" if it lacks understandability OR the logical flow is flawed.
          - "0" if it lacks understandability AND logical flow is flawed.
        - **Comment**: Provide a concise explanation for your score, highlighting examples where clarity or logical flow is strong or weak.

  - section: "2. Quality Rate"
    description: "Evaluate the degree to which the output provides value in addressing MRM requirements."
    prompt: |
      Evaluate the following output for quality:
      Output: {output}
      MRM requirements are as follows:
      - {requirements}
      Criteria:
        - Does the information present address (at least partially) the MRM requirements?
      Provide:
        - **Score**:
          - "1" if the output fully addresses the requirements.
          - "0.5" if it partially addresses requirements but needs adaptation or improvement.
          - "0" if it does not address the requirements at all.
        - **Comment**: Provide a concise explanation for your score, referencing specific MRM requirements as necessary.

  - section: "3. Capture Rate"
    description: "Calculate the percentage of requested key items included in the output."
    prompt: |
      Evaluate the capture rate for the following output:
      Output: {output}
      MRM requirements are as follows:
      - {requirements}
      Criteria to evaluate the capture rate:
        - Identify the total number of requirements (req_total).
        - Identify the number of requirements met in the output (req_output).
        - Calculate Capture Rate as req_output / req_total.
      Provide:
        - **Score**: Provide the calculated capture rate (0.00 to 1.00).
        - **Comment**: Provide a concise explanation for your score, identifying any missing or insufficiently addressed requirements.

  - section: "4. Hallucination Rate"
    description: "Evaluate whether the output contains information irrelevant to MRM requirements, question, or guidelines."
    prompt: |
      Evaluate the following output for hallucination:
      Question: {question}
      Guidelines: {guidelines}
      Output: {output}
      MRM requirements are as follows:
      - {requirements}
      Criteria:
        - Does the output introduce information that is clearly irrelevant, fabricated, or unsupported by the question, guidelines, or MRM requirements?
        - Assume the output may have leveraged general or project-specific context unless it explicitly contradicts MRM relevance.
      Provide:
        - **Score**:
          - "0" if the output plausibly aligns with the question, guidelines, or MRM requirements.
          - "1" if the output demonstrably includes irrelevant, fabricated, or unsupported information that cannot be justified by any reasonable MRM context.
        - **Comment**: Provide a concise explanation for your score, identifying specific content that is irrelevant or unsupported by the MRM requirements or question/guidelines.
